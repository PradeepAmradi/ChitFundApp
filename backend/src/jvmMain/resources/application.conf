ktor {
    application {
        modules = [ com.chitfund.backend.ApplicationKt.module ]
    }
    
    deployment {
        port = ${?PORT}
        port = 8080
        host = 0.0.0.0
        
        # SSL Configuration for production
        ssl {
            keyStore = ${?SSL_KEYSTORE_PATH}
            keyAlias = ${?SSL_KEY_ALIAS}
            keyStorePassword = ${?SSL_KEYSTORE_PASSWORD}
            privateKeyPassword = ${?SSL_PRIVATE_KEY_PASSWORD}
        }
    }
}

# Database configuration - use environment variables for production
database {
    url = ${?DATABASE_URL}
    url = "jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1"  # Default for development
    driver = ${?DATABASE_DRIVER}
    driver = "org.h2.Driver"  # Default for development
    user = ${?DATABASE_USER}
    user = "sa"  # Default for development
    password = ${?DATABASE_PASSWORD}
    password = ""  # Default for development
    maxPoolSize = ${?DATABASE_POOL_SIZE}
    maxPoolSize = 10  # Default
}

# JWT configuration - CRITICAL: Use strong secrets in production
jwt {
    secret = ${?JWT_SECRET}
    secret = "secure-jwt-secret-key-change-in-production-256-bits-minimum"  # Development only
    issuer = ${?JWT_ISSUER}
    issuer = "chitfund-app"
    audience = ${?JWT_AUDIENCE}  
    audience = "chitfund-users"
    access_token_expiry_minutes = ${?JWT_ACCESS_EXPIRY}
    access_token_expiry_minutes = 15
    refresh_token_expiry_days = ${?JWT_REFRESH_EXPIRY}
    refresh_token_expiry_days = 7
}

# OTP configuration
otp {
    expiry_minutes = ${?OTP_EXPIRY_MINUTES}
    expiry_minutes = 10
    length = ${?OTP_LENGTH}
    length = 6
}

# Rate limiting configuration
rate_limit {
    daily_limit = ${?RATE_LIMIT_DAILY}
    daily_limit = 100
    auth_limit_per_minute = ${?RATE_LIMIT_AUTH}
    auth_limit_per_minute = 5
    api_limit_per_minute = ${?RATE_LIMIT_API}
    api_limit_per_minute = 50
    critical_limit_per_minute = ${?RATE_LIMIT_CRITICAL}
    critical_limit_per_minute = 10
}

# Security settings
security {
    https_enabled = ${?SECURITY_HTTPS_ENABLED}
    https_enabled = false  # Default for development
    cors_allowed_hosts = ${?CORS_ALLOWED_HOSTS}
    cors_allowed_hosts = "localhost:3000,chitfund-webapp.azurewebsites.net"
}
