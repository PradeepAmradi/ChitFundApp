ktor {
    application {
        modules = [ com.chitfund.backend.ApplicationKt.module ]
    }
    
    deployment {
        port = ${?PORT:8080}
        host = 0.0.0.0
        
        # SSL Configuration for production (commented out for development)
        # ssl {
        #     keyStore = ${?SSL_KEYSTORE_PATH}
        #     keyAlias = ${?SSL_KEY_ALIAS}
        #     keyStorePassword = ${?SSL_KEYSTORE_PASSWORD}
        #     privateKeyPassword = ${?SSL_PRIVATE_KEY_PASSWORD}
        # }
    }
}

# Database configuration - uses environment variables
database {
    url = ${?DATABASE_URL:"jdbc:postgresql://localhost:5432/chitfund"}
    user = ${?DATABASE_USER:"chitfund"}
    password = ${?DATABASE_PASSWORD:"password"}
    maxPoolSize = ${?DATABASE_POOL_SIZE:10}
}

# JWT configuration - must be set via environment variables in production
jwt {
    secret = ${?JWT_SECRET:"chitfund-default-secret-key-please-change-in-production"}
    issuer = ${?JWT_ISSUER:"chitfund-app"}
    audience = ${?JWT_AUDIENCE:"chitfund-users"}
    accessTokenExpiry = ${?JWT_ACCESS_TOKEN_EXPIRY:900} # 15 minutes in seconds
    refreshTokenExpiry = ${?JWT_REFRESH_TOKEN_EXPIRY:604800} # 7 days in seconds
}

# OTP configuration
otp {
    expiry = ${?OTP_EXPIRY_MINUTES:10}
    length = ${?OTP_LENGTH:6}
}

# Security configuration
security {
    sslEnabled = ${?SSL_ENABLED:false}
    rateLimiting {
        globalLimit = ${?RATE_LIMIT_GLOBAL:100}
        authLimit = ${?RATE_LIMIT_AUTH:5}
        apiLimit = ${?RATE_LIMIT_API:50}
        sensitiveLimit = ${?RATE_LIMIT_SENSITIVE:3}
    }
}
